<h4>
    <span class="title-font">{{ title }}</span>
    @if (!isEditMode && perms.isAllowed('change_metadata')) {
        <button class="small-button" type="button" mat-icon-button disableRipple (click)="onEdit()">
            <mat-icon>edit</mat-icon>
        </button>
    }
    @if (isEditMode && perms.isAllowed('change_metadata')) {
        <button class="small-button" type="button" mat-icon-button disableRipple (click)="onCancel()">
            <mat-icon>close</mat-icon>
        </button>
    }
</h4>

@if (!isEditMode || !perms.isAllowed('change_metadata')) {
    <div>
        @for (model of intermediateModels; track model) {
            <mat-chip-listbox class="user">
                <mat-basic-chip disableRipple>{{ model.user?.getTitle() }}</mat-basic-chip>
            </mat-chip-listbox>
        }
        @if (useAdditionalInput && additionalInputValue) {
            <mat-chip-listbox class="user">
                <mat-basic-chip disableRipple>{{ additionalInputValue }}</mat-basic-chip>
            </mat-chip-listbox>
        }
    </div>
}
@if (isEditMode && perms.isAllowed('change_metadata')) {
    <div>
        <os-sorting-list [input]="editObservable" [live]="true" [count]="false" (sortEvent)="onSortingChange($event)">
            <!-- implicit user references into the component using ng-template slot -->
            <ng-template let-user>
                <div class="single-line">
                    <span class="ellipsis-overflow">
                        {{ user.getTitle() }}
                    </span>
                    <span>
                        <button
                            type="button"
                            mat-icon-button
                            matTooltip="{{ 'Remove' | translate }}"
                            (click)="onRemove(user)"
                        >
                            <mat-icon>close</mat-icon>
                        </button>
                    </span>
                </div>
            </ng-template>
        </os-sorting-list>
        <div class="text-field-container">
            <os-participant-search-selector
                [nonSelectableUserIds]="editUserIds"
                placeholder="{{ 'Select participant' | translate }}"
                (userSelected)="addUser($event)"
            ></os-participant-search-selector>
        </div>
        @if (useAdditionalInput) {
            <div class="text-field-container">
                <mat-form-field>
                    <mat-label>{{ additionalInputLabel }}</mat-label>
                    <input matInput [formControl]="additionalInputControl" [value]="additionalInputValue" />
                </mat-form-field>
            </div>
        }
        @if (useAdditionalInput && loadSecondSelectorValues) {
            <div class="text-field-container">
                <mat-form-field>
                    <mat-label>{{ secondSelectorLabel }}</mat-label>
                    <os-list-search-selector
                        [formControl]="secondSelectorFormControl"
                        [inputListValues]="secondSelectorValues"
                        [keepOpen]="true"
                        [disableOptionWhenFn]="getDisabledFn()"
                        (openedChange)="openedChange($event)"
                    ></os-list-search-selector>
                </mat-form-field>
            </div>
        }
        <p>
            <button type="button" mat-button (click)="onSave()">
                <span>{{ 'Save' | translate }}</span>
            </button>
            <button type="button" mat-button (click)="onCancel()">
                <span>{{ 'Cancel' | translate }}</span>
            </button>
        </p>
    </div>
}
