<os-action-card [showActionRow]="true" icon="speaker_notes" [disableExpandControl]="isEditing">
    <!-- Title row -->
    <ng-container class="meta-text-block-title">
        <span>{{ 'Personal note' | translate }}</span>
    </ng-container>

    <!-- Actions -->
    <ng-container class="meta-text-block-action-row">
        @if (!isEditing) {
            <button mat-icon-button (click)="editPersonalNote()" matTooltip="{{ 'Edit' | translate }}">
                <mat-icon>edit</mat-icon>
            </button>
        }
        @if (!isEditing && (personalNoteObservable | async)) {
            <button
                mat-icon-button
                (click)="printPersonalNote()"
                matTooltip="{{ 'Export personal note only' | translate }}"
            >
                <mat-icon>picture_as_pdf</mat-icon>
            </button>
        }
        @if (isEditing) {
            <button mat-icon-button color="warn" (click)="savePersonalNote()" matTooltip="{{ 'Save' | translate }}">
                <mat-icon>done</mat-icon>
            </button>
        }
        @if (isEditing) {
            <button mat-icon-button (click)="leaveEditMode()" matTooltip="{{ 'Cancel edit' | translate }}">
                <mat-icon>close</mat-icon>
            </button>
        }
    </ng-container>

    <!-- Content -->
    <ng-container class="meta-text-block-content">
        @if (!isEditing) {
            @if ((personalNoteObservable | async)?.note; as note) {
                <div [innerHTML]="note | trust: 'html'"></div>
            }
            @if ((hasPersonalNoteObservable | async) === false) {
                <div class="no-content">
                    {{ 'No personal note' | translate }}
                </div>
            }
        }
        @if (isEditing) {
            <form [formGroup]="formGroup">
                <!-- The HTML Editor -->
                <os-editor formControlName="text"></os-editor>
            </form>
        }
        @if (saveHint) {
            <div>
                <span>{{ 'Touch the book icon to enter text' | translate }}</span>
                <br />
                <span class="red-warning-text">{{ 'Do not forget to save your changes!' | translate }}</span>
            </div>
        }
    </ng-container>
</os-action-card>
