<os-head-bar>
    <div class="title-slot">
        <h2>{{ 'Autopilot' | translate }}</h2>
    </div>
</os-head-bar>
<div class="content-container">
    <div class="col-main">
        <!-- Title Card -->
        <mat-card class="os-card" *ngIf="!!title">
            <mat-card-content>
                <a [routerLink]="viewModelUrl || null" [target]="lowerProjectionTarget" [state]="{ back: 'true' }">
                    <h1 class="line-and-icon">
                        {{ title | translate }}
                    </h1>
                </a>
            </mat-card-content>
        </mat-card>

        <!-- List of speakers -->
        <os-list-of-speakers-content
            *osPerms="[permission.listOfSpeakersCanSee, permission.listOfSpeakersCanBeSpeaker]; and: !!listOfSpeakers"
            [listOfSpeakers]="listOfSpeakers!"
            (canReaddLastSpeakerEvent)="canReaddLastSpeaker = $event"
        >
            <ng-template osListOfSpeakersContentTitle>
                <p class="line-and-icon subtitle-text">
                    <a [routerLink]="closUrl" *ngIf="closUrl">
                        {{ 'List of speakers' | translate }}
                    </a>
                    <span *ngIf="!closUrl">
                        {{ 'List of speakers' | translate }}
                    </span>

                    <ng-container *osPerms="permission.listOfSpeakersCanManage; complement: true">
                        <mat-icon
                            *ngIf="isLosClosed"
                            matTooltip="{{ 'The list of speakers is closed.' | translate }}"
                            matTooltipPosition="above"
                        >
                            lock
                        </mat-icon>
                    </ng-container>

                    <ng-container *osPerms="permission.listOfSpeakersCanManage">
                        <button mat-icon-button (click)="toggleListOfSpeakersOpen()">
                            <mat-icon
                                *ngIf="isLosClosed"
                                matTooltip="{{ 'The list of speakers is closed.' | translate }}"
                                matTooltipPosition="above"
                            >
                                lock
                            </mat-icon>

                            <mat-icon
                                *ngIf="!isLosClosed"
                                matTooltip="{{ 'The list of speakers is open.' | translate }}"
                                matTooltipPosition="above"
                            >
                                lock_open
                            </mat-icon>
                        </button>

                        <button
                            mat-icon-button
                            (click)="readdLastSpeaker()"
                            matTooltip="{{ 'Re-add last speaker' | translate }}"
                            matTooltipPosition="above"
                            [disabled]="!canReaddLastSpeaker"
                        >
                            <mat-icon>undo</mat-icon>
                        </button>
                    </ng-container>
                </p>
            </ng-template>
        </os-list-of-speakers-content>

        <mat-card *ngIf="moderationNotes" class="os-card spacer-bottom-60">
            <mat-card-content>
                <p class="subtitle-text" translate>Moderation note</p>
                <p>{{ moderationNotes }}</p>
            </mat-card-content>
        </mat-card>

        <!-- Poll-Collection -->
        <os-poll-collection *ngIf="showPollCollection" [currentProjection]="projectedViewModel"></os-poll-collection>

        <!-- Projector -->
        <mat-card class="os-card spacer-bottom-60">
            <mat-card-content>
                <a [routerLink]="projectorUrl" [target]="projectionTarget" [state]="{ back: 'true' }">
                    <p class="subtitle-text">{{ projectorTitle | translate }}</p>
                </a>

                <a [routerLink]="viewModelUrl || null" [target]="lowerProjectionTarget" [state]="{ back: 'true' }">
                    <div class="projector">
                        <os-projector *ngIf="projector" [projector]="projector"></os-projector>
                    </div>
                </a>
            </mat-card-content>
        </mat-card>
    </div>

    <div *ngIf="structureLevelCountdownEnabled && listOfSpeakers" class="col-right">
        <mat-card class="os-card spacer-bottom-60">
            <mat-card-content>
                <div class="action-title">
                    <p class="subtitle-text" translate>Speaking times</p>
                    <ng-container *ngIf="permission.projectorCanManage">
                        <button type="button" mat-icon-button [matMenuTriggerFor]="projectionMenu">
                            <mat-icon>more_horiz</mat-icon>
                        </button>
                    </ng-container>
                </div>
                <os-speaking-times
                    [currentSpeakingTimes]="listOfSpeakers.structure_level_list_of_speakers_ids"
                ></os-speaking-times>
            </mat-card-content>
        </mat-card>
    </div>
</div>

<mat-menu #projectionMenu="matMenu">
    <button mat-menu-item (click)="showAllStructureLevels()">
        <mat-icon>videocam</mat-icon>
        <span>{{ 'Project all structure levels' | translate }}</span>
    </button>
    <button mat-menu-item (click)="showActiveStructureLevel()">
        <mat-icon>videocam</mat-icon>
        <span>{{ 'Project active structure level' | translate }}</span>
    </button>
</mat-menu>
